---
layout: default
title: Debugging NFS kdump 
parent: Debug
grand_parent: Developer Information
---


# Debugging NFS kdump

22\.04 HostOS is dumping over NFS, directly to the deployers. HostOS kdump is configured to capture coredump, then system is left in the initramfs prompt for further action by a human.

  
hostos\-config\-payloads/scripts/config\_kdump\_1\.0\.0\.sh defines kernelcrashrecipe file for HostOS.

  


In HostOS:  
/etc/default/kdump\-tools.conf contains kexec kernel command lines and kdump configuration options. If you make changes to this file, then run:  
% `kdump-config unload; kdump-config load; kdump-config show`;Â  \# to pick up the configuration changes.

* add "`debug`" to exec command line to turn on debugging, (then remember to rerun the unload, load kdump\-config commands above.)

  


Initramfs\-tool scripts execution order:

/usr/share/initramfs\-tools/init

* parse boot arguments
* /scripts/init\-top
* load\_modules
* /scripts/init\-premount/\*
* /scripts/$BOOT, BOOT\=local or nfs
* mountroot function \- defined in scripts/BOOT


	+ (for local) calls pre\_mountroot (and scripts/local\-top/\*)
	+ (for local) calls scripts/local\-premount/\*
	+ (for local) mounts
	+ (for local) calls scripts/local\-bottom/\*
* /scripts/init\-bottom/\*
* exec init

  


makdeumpfile\-R.pl \# rearranged dump files

  
\#\# rebuild initramfs  
KDUMP\_DIR\="/usr/share"  
initrd\="my\-initrd.img"


```
mkinitramfs -d ${KDUMP_DIR}/initramfs-tools -o "$initrd" $(uname -r)
```
  


To analyze dump:

* Get a VM
* install dbgsym kernel, ie: linux\-image\-unsigned\*\<version\>\*dbgsym\*amd64\.ddeb
* crash /usr/lib/debug/boot/vmlinux\-\<version\> dump.file

Need more help? Juan Alvarez wrote most of config\_kdump\_1\.0\.0\.sh



 


Document generated by Confluence on Jul 15, 2024 13:04


[Atlassian](https://www.atlassian.com/)


 


